<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflicks</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="nav" id="navContainer">
        <nav class="navbar">
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="movie-section.html">Movies</a>
                <a href="tv-section.html">TV Shows</a>
                <a href="#">My List</a>
            </div>
            
            <div class="search-bar">
                <input type="text" class="search-bar" id="movie-search" placeholder="Search">
                <button type="submit" class="play-button" id="play-button">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </nav>
    </div>

    <div class="home" id="home">
        <div class="section" id="new">
            <h2>New on Netflicks</h2>
            <div class="movie-list" id="new"></div>
        </div>
        <div class="section" id="next">
            <h2>Your Next Watch</h2>
            <div class="movie-list" id="next"></div>
        </div>
        <div class="section" id="today">
            <h2>Today's Top Picks For You</h2>
            <div class="movie-list" id="today"></div>
        </div>
    </div>

    <script>
        // Function to fetch movie data from OMDB API
        async function fetchMovieData(title) {
            const apiKey = 'e5a0f4ec';
            const apiUrl = `https://www.omdbapi.com/?apikey=${apiKey}&t=${encodeURIComponent(title)}`;
            
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching movie data:', error);
                return null;
            }
        }

        // Function to display movies in a section
        async function fetchAndDisplayMovies(sectionId, movies) {
            const section = document.getElementById(sectionId);
            const movieList = section.querySelector('.movie-list');

            for (let i = 0; i < movies.length; i++) {
                const movieTitle = movies[i];
                const movieData = await fetchMovieData(movieTitle);

                if (movieData && movieData.Poster && movieData.Title && movieData.imdbID) {
                    const movieCard = document.createElement('div');
                    movieCard.classList.add('movie-card');

                    const posterLink = document.createElement('a');
                    const data = {
                        title: movieData.Title,
                        id: movieData.imdbID,
                        year: movieData.Year
                    };
                    const jsonString = JSON.stringify(data);
                    posterLink.href = `movie.html?data=${encodeURIComponent(jsonString)}`;

                    const posterImg = document.createElement('img');
                    posterImg.classList.add('movie-poster');
                    posterImg.src = movieData.Poster;
                    posterImg.alt = `${movieData.Title} Poster`;

                    posterLink.appendChild(posterImg);
                    movieCard.appendChild(posterLink);

                    movieList.appendChild(movieCard);
                }
            }
        }

        async function displayMovies() {
            await fetchAndDisplayMovies('new', [
                "The Boys",
                "Bridgerton",
                "The Acolyte",
                "Geek Girl",
                "Kota Factory",
                "Supacell",
                "Superman & Lois",
                "House of the Dragon"
            ]);

            await fetchAndDisplayMovies('next', [
                "Peacemaker",
                "Sugar",
                "Fallout",
                "3 Body Problem",
                "The Lord of the Rings: The Rings of Power",
                "Money Heist",
                "The Gentlemen",
                "Bel-Air"
            ]);

            await fetchAndDisplayMovies('today', [
                "Sherlock",
                "Dark",
                "The Flash",
                "Stranger Things",
                "How I Met Your Mother",
                "Rick and Morty",
                "Thirteen Reasons Why",
                "YOU",
                "Percy Jackson and the Olympians"
            ]);
        }

        displayMovies();

        document.getElementById('play-button').addEventListener('click', function() {
            var movieTitle = document.getElementById('movie-search').value.trim();
            if (movieTitle !== '') {
                fetch(`https://www.omdbapi.com/?apikey=e5a0f4ec&t=${encodeURIComponent(movieTitle)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.Response === 'True') {
                            const movieData = {
                                title: data.Title,
                                id: data.imdbID,
                                year: data.Year
                            };
                            const jsonString = JSON.stringify(movieData);
                            window.location.href = 'movie.html?data=' + encodeURIComponent(jsonString);
                        } else {
                            alert('Title not found! Please try again.');
                        }
                    })
                    .catch(error => {
                        alert('Error fetching movie data. Please try again later.');
                        console.log(error);
                    });
            } else {
                alert('Please enter a movie title.');
            }
        });
    </script>
</body>
</html>
